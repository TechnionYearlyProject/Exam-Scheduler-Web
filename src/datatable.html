<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="datatable.css">
    <meta charset="UTF-8">
</head>
<body>
<input type="text" id="search_box" style="width: 439px; font-size: 13px; outline: none; border-color: rgba(0,0,0,.12); border-width: 1px; border-bottom-width: 0px; padding-right: 4px;" placeholder="חיפוש קורסים...">
<table id="example" class="mdl-data-table" style="max-width:420px; min-width: 420px; table-layout: fixed">
    <thead style="padding-left: 0px;">
    <tr>
        <th></th>
        <th style="padding-left: 0px">מספר</th>
        <th>שם הקורס</th>
        <th style="padding-left: 0px">העדפה</th>
        <th style="padding-left: 0px">למידה</th>
    </tr>
    </thead>
</table>
<script type="module">
    import { sendRequest } from './js/request';
    function format ( d ) {
        return '\n' +
            '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">\n' +
            '    <tr>\n' +
            '        <td>שבץ בלוח המבחנים:</td>\n' +
            '        <td>\n' +
            '            <label class="switch" style="margin-bottom: -2px; display: inline-block">\n' +
            '                <input type="checkbox" checked>\n' +
            '                <span class="slider round"></span>\n' +
            '            </label>\n' +
            '        </td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>נקודות זכות:</td>\n' +
            '        <td>3.5</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>פקולטה:</td>\n' +
            '        <td>מדעי המחשב</td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>ניהול התנגשויות:</td>\n' +
            '        <td>\n' +
            '            <button type="button" class="btn btn-secondary btn-sm" style="">\n' +
            '                <i class="fas fa-link"></i>\n' +
            '            </button>\n' +
            '        </td>\n' +
            '    </tr>\n' +
            '    <tr>\n' +
            '        <td>מועד שיבוץ:</td>\n' +
            '        <td>\n' +
            '            <div class="btn-group btn-group-toggle" data-toggle="buttons">\n' +
            '                <label class="btn btn-secondary active btn-sm" style="display: inline-block; padding-right: 7px; padding-left: 7px;">\n' +
            '                    <input type="radio" name="options" id="option1" autocomplete="off">\n' +
            '                    <i class="fas fa-arrow-right"></i>\n' +
            '                </label>\n' +
            '                <label class="btn btn-secondary btn-sm" style="display: inline-block; padding-right: 7px; padding-left: 7px;">\n' +
            '                    <input type="radio" name="options" id="option2" autocomplete="off" checked>\n' +
            '                    <i class="fas fa-minus"></i>\n' +
            '                </label>\n' +
            '                <label class="btn btn-secondary btn-sm" style="display: inline-block; padding-right: 7px; padding-left: 7px;">\n' +
            '                    <input type="radio" name="options" id="option3" autocomplete="off">\n' +
            '                    <i class="fas fa-arrow-left"></i>\n' +
            '                </label>\n' +
            '            </div>\n' +
            '        </td>\n' +
            '    </tr>\n' +
            '</table>';
    }
    $(document).ready(function() {
        var table = $('#example').DataTable( {
            scrollY: 523,
            paging: false,
            info: false,
            "dom": 'lrt',
            "columnDefs": [
                { "width": "25px", "targets": 0 },
                { "width": "75px", "targets": 1 },
                { "width": "75px", "targets": 3 },
                { "width": "70px", "targets": 4 },
            ],
            "columns": [
                {
                    "className":      'details-control',
                    "orderable":      false,
                    "data":           null,
                    "defaultContent": '',
                    "render": function () {
                        return '<i class="fas fa-angle-down"></i>';
                    },
                },
                { "data": "id" },
                { "data": "name" },
                { "data": "pref" },
                { "data": "credit_points" }
            ],
            "order": [[1, 'asc']]

        } );
        $('#example tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var tdi = tr.find("i.fas");
            var row = table.row( tr );
            if ( row.child.isShown() ) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
                tdi.first().removeClass('fa-angle-up');
                tdi.first().addClass('fa-angle-down');
            }
            else {
                // Open this row
                row.child( format(row.data()) ).show();
                tr.addClass('shown');
                tdi.first().removeClass('fa-angle-down');
                tdi.first().addClass('fa-angle-up');
            }
        }
        );
        $('#search_box').keyup(function(){
            table.search($(this).val()).draw() ;
        })

        var dict = [];
        var req1 = sendRequest("get", "/api/2018-spring/course/list", null, function(res) {
            var courses = JSON.parse(res);
            for (var i in courses)
            {
                var pref = "";
                if (!courses[i]["is_first"] && !courses[i]["is_last"])
                    pref  = "אוטומטי";
                else if (courses[i]["is_first"])
                    pref  = "התחלה";
                else if (courses[i]["is_last"])
                    pref  = "סוף";
                var reshuma = {
                    "id" : courses[i]["id"],
                    "name" : courses[i]["name"],
                    "pref" : pref,
                    "credit_points" : courses[i]["credit_point"]["$numberDecimal"],
                };
                dict.push(reshuma);
                table.row.add(reshuma).draw();
            }
        });
        console.log(dict);



    } );
</script>
</body>
</html>