<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="datatable.css">
    <meta charset="UTF-8">
</head>
<body>
<input type="text" id="search_box"
       style="width: 100%; font-size: 13px; outline: none; border-color: rgba(0,0,0,.12); border-width: 1px; border-bottom-width: 0px; padding-right: 4px;"
       placeholder="חיפוש קורסים...">
<table id="example" class="mdl-data-table" style="max-width:500px; min-width: 500px; table-layout: fixed">
    <thead style="padding-left: 0px;">
    <tr>
        <th></th>
        <th>ID</th>
        <th>שם</th>
        <th>העדפה</th>
    </tr>
    </thead>
</table>
<script type="module">
  import {sendRequest} from "./js/request";

  function format(d) {
    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
    '<tr>' +
    '<td>ניהול התנגשויות</td>' +
    '<td>' + d.name + '</td>' +
    '</tr>' +
    '<tr>' +
    '<td>סמסטרים שנלקח</td>' +
    '<td></td>' +
    '</tr>' +
    '<tr>' +
    '<td>פקולטה מנהלת</td>' +
    '<td>כמות נקודות</td>' +
    '<td>האם לשבץ</td>' +
    '</tr>' +
    '</table>';
  }

  $(document).ready(function () {
    let table = $('#example').DataTable({
      scrollY: 500,
      paging: false,
      info: false,
      "dom": 'lrt',
      "columns": [
        {
          "className": 'details-control',
          "orderable": false,
          "width": "15px",
          "defaultContent": '',
          "render": function () {return '<i class="fas fa-angle-down"></i>'}
        },
        {
          "data": "id",
          "width": "50px"
        },
        {
          "data": "name",
          "width": "100px"
        },
        {
          "data": "credit_point",
          "width": "100px"
        },
      ],
      "order": [[1, 'asc']]
    });

    $('#example tbody').on('click', 'td.details-control', function () {
      var tr = $(this).closest('tr');
      var tdi = tr.find("i.fas");
      var row = table.row(tr);

      if (row.child.isShown()) {
        // This row is already open - close it
        row.child.hide();
        tr.removeClass('shown');
        tdi.first().removeClass('fa-angle-up');
        tdi.first().addClass('fa-angle-down');
      }
      else {
        // Open this row
        row.child(format(row.data())).show();
        tr.addClass('shown');
        tdi.first().removeClass('fa-angle-down');
        tdi.first().addClass('fa-angle-up');
      }
    });

    $('#search_box').keyup(function () {
      table.search($(this).val()).draw();
    })

    sendRequest("get", "/api/2018-winter/course/list", null, function (res) {
      let data = JSON.parse(res);
      for (let i in data) {
        data[i].credit_point = data[i].credit_point.$numberDecimal.toString();
        data[i].id = data[i].id.toString();
        delete data[i]._id;
        table.row.add(data[i]);
        table.draw();
      }
    });
  });
</script>

</body>
</html>