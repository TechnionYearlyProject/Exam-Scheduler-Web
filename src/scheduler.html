<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.0/material.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.material.min.css">
    <script src="resources/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="resources/bootstrap.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
    <link rel="stylesheet" href="resources/bootstrap-rtl.css">
    <script src="resources/bootstrap.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker3.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/locales/bootstrap-datepicker.he.min.js"></script>
    <link rel="shortcut icon" type="image/png" href="graphics/favicon.ico"/>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.material.min.js"></script>
    <script type="text/javascript" src="funcs.js"></script>
    <meta charset="utf-8">
    <title>Technion Exam Scheduler</title>
</head>
<body style="overflow-x: hidden;">
<div id="toolbar"></div>
<div class="dropdown navbar" style="padding: 0px;">
    <label class="dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-weight: bold; font-size: 32px; padding-right: 16px; padding-top: 10px;">
        סמסטר אביב תשע"ח
    </label>
    <div id= "sem_picker" class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="background-color: rgba(255,255,255,0.80); margin-right: 15px; width: 350px; margin-top: -5px;">
        <a class="dropdown-item" href="#" id="sem_0">סמסטר אביב תשע"ח</a>
        <a class="dropdown-item" href="#" id="sem_1">סמסטר חורף תשע"ח</a>
        <a class="dropdown-item" href="#" id="sem_2">סמסטר קיץ תשע"ז</a>
        <a class="dropdown-item" href="#" id="sem_3">סמסטר אביב תשע"ז</a>
        <a class="dropdown-item" href="#" id="sem_4">סמסטר חורף תשע"ז</a>
        <a class="dropdown-item" href="#" id="sem_5">סמסטר קיץ תשע"ו</a>
    </div>
</div>
<div class="form-group row" style="text-align: right; padding-right: 50px; padding-left: 50px; padding-top: 0px; margin-top: 0px !important;">
  <div class="container-fluid col">
    <div id="courses"></div>
  </div>
  <div class="container-fluid col">
    <div id="moed_a"></div>
  </div>
  <div class="container-fluid col">
    <div id="moed_b"></div>
  </div>
</div>
<div class="modal fade" data-backdrop="false" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="margin-top: 90px;">
        <div class="modal-content" style="width: 440px;">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">בונה לוחות מבחנים</h5>
            </div>
            <div class="modal-body" align="center">
                <img src="graphics/load.gif">
            </div>
        </div>
    </div>
</div>

<script>
    var dict = {};
    dict["sem_0"] = {name:"סמסטר אביב תשע\"ח", a_start:new Date(2018,6,4), a_end:new Date(2018,6,27), b_start:new Date(2018,9,3), b_end:new Date(2018,9,19)};
    dict["sem_1"] = {name:"סמסטר חורף תשע\"ח", a_start:new Date(2018,0,29), a_end:new Date(2018,1,20), b_start:new Date(2018,1,27), b_end:new Date(2018,2,19)};
    dict["sem_2"] = {name:"סמסטר קיץ תשע\"ז", a_start:new Date(2017,8,25), a_end:new Date(2017,9,23), b_start:new Date(2017,9,23), b_end:new Date(2017,9,23)};
    dict["sem_3"] = {name:"סמסטר אביב תשע\"ז", a_start:new Date(2017,6,7), a_end:new Date(2017,6,31), b_start:new Date(2017,8,25), b_end:new Date(2017,9,23)};
    dict["sem_4"] = {name:"סמסטר חורף תשע\"ז", a_start:new Date(2017,0,30), a_end:new Date(2017,1,21), b_start:new Date(2017,1,28), b_end:new Date(2017,2,19)};
    dict["sem_5"] = {name:"סמסטר קיץ תשע\"ו", a_start:new Date(2016,8,12), a_end:new Date(2016,8,28), b_start:new Date(2016,8,28), b_end:new Date(2016,8,28)};
    $('.dropdown-item').click(function() {
        document.getElementById('dropdownMenuButton').innerHTML = this.innerHTML+" ";
        var start_a = new Date(dict[this.id].a_start.getTime());
        var end_a = new Date(dict[this.id].a_end.getTime());
        var start_b = new Date(dict[this.id].b_start.getTime());
        var end_b = new Date(dict[this.id].b_end.getTime());
        make_calendar(start_a,end_a,"a");
        make_calendar(start_b,end_b,"b");
    });
    $('#toolbar').load('toolbar.html');
    $('#moed_a').load('moed_a.html');
    $('#moed_b').load('moed_b.html');
    $('#courses').load('datatable.html', function () {
      $('#scheduler_function_caller').click(function(){
          $("[id^='exam_for_']").remove();
          $('#exampleModal').modal("show");
          setTimeout(function () {
              $('#exampleModal').modal("hide");
              $.ajax({url: "/make-schedule", success: function(result){
                      result = JSON.parse(result);
                      for(var i = 0; i < result.length; i++){
                          console.log(result[i]);
                          var day = '#moed_a_day_' + result[i].index;
                          for (var j = 0; j < result[i].exams.length; j++){
                              var test = document.createElement("div");
                              test.id = "exam_for_" + result[i].exams[j]["id"];
                              test.className = "test";
                              //test.style.margin = "2px 1px 2px 1px";
                              var id = result[i].exams[j]["id"];
                              var color = "#FFA726";
                              if (id.startsWith("234")){
                                  color = "#26A69A";
                              } else if (id.startsWith("104")){
                                  color = "#EF5350";
                              } else if (id.startsWith("094")) {
                                  color = "#FFEB3B";
                              } else if (id.startsWith("236")) {
                                  color = "#9CCC65";
                              }
                              test.style.backgroundColor = color;
                              test.style.width = "60px";
                              test.innerHTML = result[i].exams[j]["name"];
                              $(day).append(test);
                          }
                      }
                  }
              });
          }, 5000);
          $("#schedule_clear").click(function(){
              //$("[id^='moed_a_day_']").remove("[id^='exam_for_']");
              $("[id^='exam_for_']").remove();
          });
      });
      $('#scheduler_function_caller_2').click(function(){
          $("[id^='exam_for_']").remove();
          $.ajax({url: "/make-schedule", success: function(result){
                  //console.log(result);
                  result = JSON.parse(result);
                  for(var i = 0; i < result.length; i++){
                      console.log(result[i]);
                      var day = '#moed_a_day_' + result[i].index;
                      for (var j = 0; j < result[i].exams.length; j++){
                          var test = document.createElement("div");
                          test.id = "exam_for_" + result[i].exams[j]["id"];
                          test.className = "test";
                          //test.style.margin = "2px 1px 2px 1px";
                          var id = result[i].exams[j]["id"];
                          var color = "#FFA726";
                          if (id.startsWith("234")){
                              color = "#26A69A";
                          } else if (id.startsWith("104")){
                              color = "#EF5350";
                          } else if (id.startsWith("094")) {
                              color = "#FFEB3B";
                          } else if (id.startsWith("236")) {
                              color = "#9CCC65";
                          }
                          test.style.backgroundColor = color;
                          test.style.width = "60px";
                          test.innerHTML = result[i].exams[j]["name"];
                          $(day).append(test);
                      }
                  }
              }
          });
          $("#schedule_clear").click(function(){
              //$("[id^='moed_a_day_']").remove("[id^='exam_for_']");
              $("[id^='exam_for_']").remove();
          })
      });
  });
  console.log("here");

</script>
</body>
</html>
